{% extends "base.html" %}
{% block title %}{% if filter_type %}Favourite {{ filter_type.capitalize() }}s{% else %}Favourites{% endif %} Â· Popularr{% endblock %}
{% block content %}
<div class="container-fluid py-3 py-md-4">
  <div class="row mb-3">
    <div class="col-12 col-md-auto">
      <h1 class="h3 mb-2">
        <i class="bi bi-star-fill"></i> 
        {% if filter_type == 'artist' %}
          Favourite Artists
        {% elif filter_type == 'album' %}
          Favourite Albums
        {% elif filter_type == 'track' %}
          Favourite Tracks
        {% else %}
          Favourites
        {% endif %}
      </h1>
      <p class="text-muted mb-0">Quick access to your favorite artists, albums, and tracks</p>
    </div>
    {% if filter_type %}
    <div class="col-12 col-md-auto ms-auto">
      <a href="{{ url_for('bookmarks') }}" class="btn btn-outline-secondary">
        <i class="bi bi-star"></i> View All Favourites
      </a>
    </div>
    {% endif %}
  </div>

  {% if bookmarks and bookmarks|length > 0 %}
    <!-- Artists Bookmarks -->
    {% set artist_bookmarks = bookmarks | selectattr('type', 'equalto', 'artist') | list %}
    {% if artist_bookmarks %}
    <div class="card shadow-sm mb-3">
      <div class="card-header bg-secondary bg-opacity-10 border-bottom">
        <h5 class="mb-0"><i class="bi bi-people"></i> Artists</h5>
      </div>
      <div class="card-body">
        <div class="row g-2">
          {% for bookmark in artist_bookmarks %}
          <div class="col-12 col-sm-6 col-md-4 col-lg-3">
            <div class="card h-100">
              <div class="card-body p-2">
                <div class="d-flex justify-content-between align-items-center">
                  <a href="{{ url_for('artist_detail', name=bookmark.artist) }}" class="text-decoration-none flex-grow-1">
                    <i class="bi bi-person-circle"></i> {{ bookmark.artist }}
                  </a>
                  <button class="btn btn-sm btn-outline-danger" onclick="removeBookmark({{ bookmark.id }})" title="Remove bookmark">
                    <i class="bi bi-x"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
    {% endif %}

    <!-- Albums Bookmarks -->
    {% set album_bookmarks = bookmarks | selectattr('type', 'equalto', 'album') | list %}
    {% if album_bookmarks %}
    <div class="card shadow-sm mb-3">
      <div class="card-header bg-secondary bg-opacity-10 border-bottom">
        <h5 class="mb-0"><i class="bi bi-album"></i> Albums</h5>
      </div>
      <div class="card-body">
        <div class="row g-2">
          {% for bookmark in album_bookmarks %}
          <div class="col-12 col-sm-6 col-md-4 col-lg-3">
            <div class="card h-100">
              <div class="card-body p-2">
                <div class="d-flex justify-content-between align-items-start">
                  <div class="flex-grow-1">
                    <a href="{{ url_for('album_detail', artist=bookmark.artist, album=bookmark.album) }}" class="text-decoration-none">
                      <div class="fw-bold text-truncate">{{ bookmark.album }}</div>
                      <div class="text-muted small">{{ bookmark.artist }}</div>
                    </a>
                  </div>
                  <button class="btn btn-sm btn-outline-danger" onclick="removeBookmark({{ bookmark.id }})" title="Remove bookmark">
                    <i class="bi bi-x"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
    {% endif %}

    <!-- Tracks Bookmarks -->
    {% set track_bookmarks = bookmarks | selectattr('type', 'equalto', 'track') | list %}
    {% if track_bookmarks %}
    <div class="card shadow-sm mb-3">
      <div class="card-header bg-secondary bg-opacity-10 border-bottom">
        <h5 class="mb-0"><i class="bi bi-music-note"></i> Tracks</h5>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead>
              <tr>
                <th>Track</th>
                <th>Artist</th>
                <th>Album</th>
                <th class="text-center" style="width: 100px;">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for bookmark in track_bookmarks %}
              <tr>
                <td>
                  <a href="{{ url_for('track_detail', track_id=bookmark.track_id) }}" class="text-decoration-none">
                    {{ bookmark.name }}
                  </a>
                </td>
                <td>{{ bookmark.artist }}</td>
                <td>{{ bookmark.album }}</td>
                <td class="text-center">
                  <button class="btn btn-sm btn-outline-danger" onclick="removeBookmark({{ bookmark.id }})" title="Remove bookmark">
                    <i class="bi bi-trash"></i>
                  </button>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
    {% endif %}
  {% else %}
    <div class="alert alert-info">
      <i class="bi bi-info-circle"></i> You don't have any bookmarks yet. 
      Add bookmarks from artist, album, or track pages using the <i class="bi bi-bookmark"></i> button.
    </div>
  {% endif %}
</div>

<!-- Toast notification -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
  <div id="bookmarkToast" class="toast" role="alert">
    <div class="toast-header">
      <i class="bi bi-bookmark-star me-2"></i>
      <strong class="me-auto" id="toastTitle">Bookmark</strong>
      <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
    </div>
    <div class="toast-body" id="toastMessage">
      Message
    </div>
  </div>
</div>

<script>
function showToast(title, message, type = 'info') {
  const toast = new bootstrap.Toast(document.getElementById('bookmarkToast'));
  document.getElementById('toastTitle').textContent = title;
  document.getElementById('toastMessage').textContent = message;
  
  const toastEl = document.getElementById('bookmarkToast');
  toastEl.classList.remove('bg-success', 'bg-danger', 'bg-warning');
  if (type === 'success') toastEl.classList.add('bg-success', 'text-white');
  else if (type === 'error') toastEl.classList.add('bg-danger', 'text-white');
  else if (type === 'warning') toastEl.classList.add('bg-warning', 'text-dark');
  
  toast.show();
}

function removeBookmark(bookmarkId) {
  if (!confirm('Are you sure you want to remove this bookmark?')) {
    return;
  }
  
  fetch('/api/bookmarks/' + bookmarkId, {
    method: 'DELETE',
    headers: {
      'Content-Type': 'application/json'
    }
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      showToast('Success', 'Bookmark removed', 'success');
      // Reload page after a short delay
      setTimeout(() => window.location.reload(), 500);
    } else {
      showToast('Error', data.error || 'Failed to remove bookmark', 'error');
    }
  })
  .catch(error => {
    showToast('Error', 'Network error: ' + error.message, 'error');
  });
}
</script>

<style>
.card {
    background-color: var(--secondary-bg) !important;
    border-color: var(--border-color) !important;
}

.card-header {
    background-color: var(--primary-bg) !important;
    border-bottom-color: var(--border-color) !important;
    color: var(--text-primary) !important;
}

.card-body {
    background-color: var(--secondary-bg) !important;
    color: var(--text-primary) !important;
}

.table {
    color: var(--text-primary) !important;
    background-color: transparent !important;
}

.table thead th {
    background-color: var(--primary-bg) !important;
    color: var(--text-primary) !important;
    border-color: var(--border-color) !important;
}

.table tbody tr {
    background-color: transparent !important;
    border-color: var(--border-color) !important;
}

.table tbody td {
    background-color: transparent !important;
    color: var(--text-primary) !important;
    border-color: var(--border-color) !important;
}

.table-hover tbody tr:hover {
    background-color: var(--primary-bg) !important;
}
</style>
{% endblock %}
